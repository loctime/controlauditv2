# üì¶ Componentes y Hooks Reutilizables

## üéØ Resumen
Este documento cataloga todos los componentes reutilizables y hooks personalizados creados en las refactorizaciones recientes.

---

## üß© Componentes Reutilizables

### **Dashboard Higiene y Seguridad**

#### `IndiceCardCompact.jsx`
**Prop√≥sito:** Tarjeta compacta para mostrar √≠ndices t√©cnicos  
**Props:**
- `titulo` (string) - T√≠tulo del √≠ndice
- `valor` (number) - Valor del √≠ndice
- `unidad` (string) - Unidad de medida (ej: "%", "acc/MMHH")
- `icono` (ReactNode) - Icono de Material-UI
- `labelChip` (string) - Etiqueta del chip de estado
- `color` (object) - Thresholds: `{high, medium}`

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ Comparaci√≥n personalizada para re-renders
- ‚úÖ Colores din√°micos seg√∫n thresholds
- ‚úÖ Hover effects

---

#### `MetricChips.jsx`
**Prop√≥sito:** Chips de m√©tricas b√°sicas  
**Props:**
- `metricas` (object) - `{totalEmpleados, empleadosEnReposo, horasTrabajadas, diasPerdidos}`

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ Colores condicionales seg√∫n valores

---

#### `AlertState.jsx`
**Prop√≥sito:** Alertas de estado estandarizadas  
**Props:**
- `severity` (string) - "error" | "warning" | "info" | "success"
- `message` (string) - Mensaje a mostrar
- `actionLabel` (string) - Texto del bot√≥n
- `actionUrl` (string) - URL de navegaci√≥n
- `icon` (ReactNode) - Icono opcional

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ Layout responsive

---

#### `SelectoresDashboard.jsx`
**Prop√≥sito:** Selectores de empresa, sucursal y per√≠odo  
**Props:**
- `selectedEmpresa`, `selectedSucursal`, `selectedPeriodo` (string)
- `onEmpresaChange`, `onSucursalChange`, `onPeriodoChange` (func)
- `userEmpresas`, `sucursalesFiltradas` (array)
- `deshabilitado` (boolean)

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ Comparaci√≥n personalizada
- ‚úÖ Iconos integrados

---

### **Editor de Formularios**

#### `ModalEditarFormulario.jsx`
**Prop√≥sito:** Modal para editar nombre de formulario  
**Props:**
- `open` (boolean)
- `onClose` (func)
- `nombreFormulario` (string)
- `onNombreChange` (func)
- `onGuardar` (func)

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`

---

#### `ModalEditarSeccion.jsx`
**Prop√≥sito:** Modal para editar nombre de secci√≥n  
**Props similares a ModalEditarFormulario**

---

#### `ModalEditarPregunta.jsx`
**Prop√≥sito:** Modal para editar texto de pregunta  
**Props:**
- Similar a modales anteriores
- `textoPregunta` (string)
- `onTextoChange` (func)

---

#### `ModalAgregarPregunta.jsx`
**Prop√≥sito:** Modal para agregar nueva pregunta  
**Props:**
- `nuevaPregunta` (string)
- `onNuevaPreguntaChange` (func)

---

#### `ModalAgregarSeccion.jsx`
**Prop√≥sito:** Modal para agregar nueva secci√≥n  
**Props:**
- `nuevaSeccion` (string)
- `onNuevaSeccionChange` (func)

---

#### `SeccionItem.jsx`
**Prop√≥sito:** Item de secci√≥n con preguntas en tabla  
**Props:**
- `seccion`, `seccionIndex`
- `onEditarSeccion`, `onEliminarSeccion`, `onAgregarPregunta`, etc.
- `puedeEditar`, `puedeEliminar` (boolean)

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ Handlers con `useCallback`

---

#### `FormularioInfo.jsx`
**Prop√≥sito:** Informaci√≥n de formulario con metadata  
**Props:**
- `formulario` (object)
- `puedeEditar`, `puedeEliminar` (boolean)

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ Metadata calculada con `useMemo`

---

#### `FormulariosHeader.jsx`
**Prop√≥sito:** Header con controles de formularios  
**Props:**
- `isMobile`, `isSmallMobile` (boolean)
- `formularios` (array)
- `formularioSeleccionado` (object)
- Handlers: `onFormularioChange`, `onCrear`, etc.

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ Comparaci√≥n personalizada
- ‚úÖ Layout responsive

---

#### `FormularioDetalleCard.jsx`
**Prop√≥sito:** Card con informaci√≥n detallada del formulario  
**Props:**
- `formulario` (object)
- `isSmallMobile` (boolean)

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ Formateo autom√°tico de fechas
- ‚úÖ UI responsive

---

### **Capacitaciones**

#### `SelectoresCapacitaciones.jsx`
**Prop√≥sito:** Selectores de empresa, sucursal y filtros  
**Props:**
- `selectedEmpresa`, `selectedSucursal`, `filterTipo`, `filterEstado` (string)
- `onEmpresaChange`, `onSucursalChange`, `onTipoChange`, `onEstadoChange` (func)
- `userEmpresas`, `sucursalesFiltradas` (array)

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ Comparaci√≥n personalizada
- ‚úÖ Iconos integrados

---

#### `CapacitacionCard.jsx`
**Prop√≥sito:** Card para mostrar capacitaci√≥n  
**Props:**
- `capacitacion` (object)
- `onRegistrarAsistencia`, `onMarcarCompletada`, `onDuplicar`, etc. (func)

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ Acciones condicionales seg√∫n estado
- ‚úÖ Formateo autom√°tico de fechas

---

#### `CapacitacionesAlertas.jsx`
**Prop√≥sito:** Alertas de estado  
**Props:**
- `userEmpresas` (array)
- `selectedSucursal` (string)
- `sucursalesFiltradas` (array)

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ Alertas contextuales

---

#### `CapacitacionesEmptyState.jsx`
**Prop√≥sito:** Estado vac√≠o cuando no hay capacitaciones
**Caracter√≠sticas:**
- ‚úÖ UI amigable con icono
- ‚úÖ Mensaje descriptivo

---

### **Auditor√≠a**

#### `AlertasFaltantes.jsx`
**Prop√≥sito:** Alertas cuando faltan datos cr√≠ticos  
**Props:**
- `cargandoDatosRespaldo` (boolean)
- `userEmpresas`, `userSucursales`, `userFormularios` (array)

**L√≥gica:**
- Muestra error si faltan empresas
- Muestra warning si faltan sucursales
- Muestra info si faltan formularios

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `React.memo`
- ‚úÖ L√≥gica de priorizaci√≥n integrada

---

#### `AuditoriaHeader.jsx`
**Prop√≥sito:** Header con navegaci√≥n y progreso  
**Props:**
- `navigate`, `location`
- `calcularProgresoAuditoria` (func)
- `mostrarAlertaReinicio`, `setMostrarAlertaReinicio`
- `theme`, `isMobile`

---

#### `AuditoriaStepper.jsx`
**Prop√≥sito:** Stepper de pasos de auditor√≠a  
**Props:** m√∫ltiples estados y handlers

---

#### `AutoSaveAlert.jsx`
**Prop√≥sito:** Indicador de autoguardado  
**Props:**
- `isSaving`, `lastSaved`, `hasUnsavedChanges`
- `showAlert` (boolean)

---

#### `AuditoriaCompletada.jsx`
**Prop√≥sito:** Pantalla de auditor√≠a completada

---

### **Componentes Comunes** (`src/components/common/`)

#### `ErrorBoundary.jsx`
**Prop√≥sito:** Manejo de errores de React  
**Caracter√≠sticas:**
- ‚úÖ Wrapper para componentes
- ‚úÖ UI de error amigable

---

#### `OfflineIndicator.jsx`
**Prop√≥sito:** Indicador de estado offline

---

#### `OfflineIndicatorMobile.jsx`
**Prop√≥sito:** Indicador offline optimizado para m√≥vil

---

#### `SimpleOfflineDebug.jsx`
**Prop√≥sito:** Debug de conectividad en tiempo real

---

#### `AuditoriaDebugInfo.jsx`
**Prop√≥sito:** Debug espec√≠fico de auditor√≠as

---

#### `Permiso.jsx`
**Prop√≥sito:** Wrapper condicional basado en permisos  
**Props:**
- `permiso` (string) - Nombre del permiso
- `children` (ReactNode)

---

#### `PWAInstallPrompt.jsx`
**Prop√≥sito:** Prompt para instalar PWA

---

#### `FirmaDigital.jsx`
**Prop√≥sito:** Componente de firma digital

---

## ü™ù Hooks Personalizados

### **Dashboard Higiene**

#### `useDashboardDataFetch.js`
**Prop√≥sito:** Carga de empleados, accidentes y capacitaciones  
**Retorna:**
- `empleados`, `accidentes`, `capacitaciones` (array)
- `loading` (boolean)
- `recargarDatos` (func)

**Caracter√≠sticas:**
- ‚úÖ Carga paralela con `Promise.all`
- ‚úÖ Chunking para queries con >10 IDs
- ‚úÖ Cleanup de memory leaks (flag `mounted`)
- ‚úÖ Filtrado por sucursal/empresa

---

#### `useIndicesCalculator.js`
**Prop√≥sito:** C√°lculo de √≠ndices t√©cnicos  
**Retorna:**
- `calcularIndices` (func)
- `calcularPeriodo` (func)

**Caracter√≠sticas:**
- ‚úÖ C√°lculos por hora seg√∫n sucursal
- ‚úÖ Soporte para agregaciones m√∫ltiples
- ‚úÖ Thresholds configurables

---

### **Capacitaciones**

#### `useCapacitacionesData.js`
**Prop√≥sito:** Carga de capacitaciones individuales y planes anuales  
**Retorna:**
- `capacitaciones`, `planesAnuales` (array)
- `loading` (boolean)
- `recargarDatos` (func)

**Caracter√≠sticas:**
- ‚úÖ Carga paralela optimizada
- ‚úÖ Cleanup de memory leaks
- ‚úÖ Filtrado por empresa/sucursal
- ‚úÖ Queries din√°micas seg√∫n filtros

---

#### `useFilterState.js`
**Prop√≥sito:** Gesti√≥n de estado de filtros y selecci√≥n  
**Retorna:**
- Estados: `filterTipo`, `filterEstado`, `selectedEmpresa`, `selectedSucursal`
- Setters para cada estado
- `sucursalesFiltradas`, `empresasCargadas`

**Caracter√≠sticas:**
- ‚úÖ Auto-selecci√≥n de empresa si solo hay una
- ‚úÖ Restauraci√≥n desde localStorage
- ‚úÖ Sincronizaci√≥n de filtros
- ‚úÖ Memoizaci√≥n de sucursales filtradas

---

#### `useCapacitacionesHandlers.js`
**Prop√≥sito:** Handlers para acciones de capacitaciones  
**Retorna:**
- `handleRegistrarAsistencia` (func)
- `handleMarcarCompletada` (func)
- `handleDuplicar` (func)

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `useCallback`
- ‚úÖ Confirmaciones integradas
- ‚úÖ Manejo de errores

---

### **Auditor√≠a**

#### `useAuditoriaState.js`
**Prop√≥sito:** Gesti√≥n de estado de auditor√≠a  
**Retorna:** m√∫ltiples estados y setters

---

#### `useAuditoriaData.js`
**Prop√≥sito:** Carga de datos de auditor√≠a  
**Caracter√≠sticas:** listeners reactivos

---

#### `useAuditoriaHandlers.js`
**Prop√≥sito:** Manejo de eventos de auditor√≠a  
**Retorna:** handlers para CRUD

---

#### `useNavigationGuard.js`
**Prop√≥sito:** Protecci√≥n de navegaci√≥n  
**Retorna:**
- Detecci√≥n de cambios no guardados
- Confirmaci√≥n antes de salir
- Autoguardado autom√°tico

---

### **Editor de Formularios**

#### `useFormularioCache.js`
**Prop√≥sito:** Cache de formularios en localStorage  
**Retorna:**
- `useNormalizarSecciones`
- `useFormularioCache`
- `useFormularioStats`

**Caracter√≠sticas:**
- ‚úÖ Expiraci√≥n autom√°tica (5 min)
- ‚úÖ L√≠mite de tama√±o (10 formularios)
- ‚úÖ Limpieza inteligente

---

#### `useFormularioHandlers.js`
**Prop√≥sito:** Handlers de formularios  
**Retorna:** funciones de CRUD

---

#### `useFormulariosData.js`
**Prop√≥sito:** Carga de formularios con cache y filtrado multi-tenant  
**Retorna:**
- `formularios`, `formulariosCompletos` (array)
- `loading` (boolean)
- `recargar` (func)

**Caracter√≠sticas:**
- ‚úÖ Cache localStorage (10 min)
- ‚úÖ Suscripci√≥n reactiva onSnapshot
- ‚úÖ Filtrado multi-tenant
- ‚úÖ Cleanup autom√°tico

---

#### `useFormularioPermisos.js`
**Prop√≥sito:** Verificar permisos de formularios  
**Retorna:**
- `puedeEditar`, `puedeEliminar`, `puedeVer` (func)

**Caracter√≠sticas:**
- ‚úÖ Optimizado con `useCallback`
- ‚úÖ L√≥gica centralizada de permisos

---

#### `useFormularioSeleccionado.js`
**Prop√≥sito:** Gesti√≥n de selecci√≥n de formularios  
**Retorna:**
- `formularioSeleccionado`, `setFormularioSeleccionado`
- `cargandoFormulario` (boolean)
- `handleChangeFormulario` (func)

**Caracter√≠sticas:**
- ‚úÖ Auto-selecci√≥n desde query params
- ‚úÖ Sincronizaci√≥n con cache
- ‚úÖ Loading states

---

### **Hooks Globales** (`src/hooks/`)

#### `useUserProfile.js`
**Prop√≥sito:** Gesti√≥n de perfil de usuario  
**Retorna:**
- `userProfile`, `role`, `permisos`
- `createOrGetUserProfile`, `updateUserProfile`

---

#### `useUserManagement.js`
**Prop√≥sito:** Gesti√≥n de usuarios y operarios  
**Retorna:**
- `crearOperario`, `editarPermisosOperario`
- `getUsuariosDeClienteAdmin`, etc.

---

#### `usePWAInstall.js`
**Prop√≥sito:** Detecci√≥n y prompt de instalaci√≥n PWA

---

#### `useConnectivity.js`
**Prop√≥sito:** Estado de conectividad  
**Retorna:**
- `isOnline` (boolean)
- `isOfflineMode` (boolean)

---

#### `useOfflineData.js`
**Prop√≥sito:** Manejo de datos offline

---

#### `useClienteSorting.js`
**Prop√≥sito:** Ordenamiento de clientes

---

#### `useBackButton.js`
**Prop√≥sito:** Manejo de bot√≥n atr√°s en m√≥vil

---

#### `useChromePreload.js`
**Prop√≥sito:** Optimizaciones para Chrome

---

## üîß Servicios

### `src/services/`

#### `empresaService.js`
**Funciones:**
- `getUserEmpresas(userId, role, clienteAdminId)`
- `subscribeToUserEmpresas(...)` - Listener reactivo
- `crearEmpresa(data)`
- `updateEmpresa(empresaId, data)`
- `canViewEmpresa(empresaId, profile)`

---

#### `auditoriaService.js`
**Funciones:**
- `getUserAuditorias(userId, role)`
- `getAuditoriasCompartidas(userId)`
- `compartirAuditoria(...)`
- `canViewAuditoria(auditoriaId, profile, auditoriasCompartidas)`

---

#### `empleadoService.js`
**Funciones:**
- `getEmpleadosByEmpresa(empresaId)`
- `getEmpleadosBySucursal(sucursalId)`
- `getEmpleadosBySucursales(sucursalesIds)`
- `crearEmpleado(data, user)`
- `updateEmpleado(empleadoId, data, user)`

---

#### `accidenteService.js`
**Funciones:** CRUD de accidentes

---

#### `capacitacionService.js`
**Funciones:** CRUD de capacitaciones

---

#### `completeOfflineCache.js`
**Funciones:**
- `saveCompleteUserCache(...)`
- Cach√© completo para modo offline

---

#### `offlineDatabase.js`
**Funciones:** Operaciones IndexedDB

---

#### `syncQueue.js`
**Funciones:** Cola de sincronizaci√≥n offline

---

#### `userService.js`
**Funciones:** Gesti√≥n de usuarios

---

## üìä Arquitectura de Optimizaciones

### **Patrones Aplicados**

#### 1. **Componentes Memoizados**
```jsx
const Component = React.memo(({ prop1, prop2 }) => {
  // L√≥gica
}, (prevProps, nextProps) => {
  // Comparaci√≥n personalizada
  return prevProps.prop1 === nextProps.prop1;
});
```

#### 2. **Hooks con useCallback**
```jsx
const handler = useCallback(() => {
  // L√≥gica
}, [dependency1, dependency2]);
```

#### 3. **C√°lculos con useMemo**
```jsx
const calculated = useMemo(() => {
  return heavyCalculation(data);
}, [data]);
```

#### 4. **Cleanup Patterns**
```jsx
useEffect(() => {
  let mounted = true;
  const asyncWork = async () => {
    if (mounted) {
      // Actualizar estado
    }
  };
  return () => { mounted = false; };
}, [deps]);
```

---

## üéØ Uso Recomendado

### **Para Nuevos Componentes**

1. **Crear componente reutilizable** si se usa 2+ veces
2. **Memoizar** si recibe props estables
3. **Extraer hooks** si l√≥gica >50 l√≠neas
4. **Crear servicios** si hay queries/complejidad

### **Estructura de Archivos**

```
src/components/
‚îú‚îÄ‚îÄ common/              # Globales
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ dashboard-higiene/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/  # Espec√≠ficos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/       # Espec√≠ficos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.jsx
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ context/             # Contextos

src/hooks/               # Hooks globales
src/services/            # Servicios
src/utils/               # Utilidades
```

---

## üìà M√©tricas de Mejora

### **Reducciones Logradas**
| Archivo | Antes | Despu√©s | Reducci√≥n |
|---------|-------|---------|-----------|
| `DashboardHigieneSeguridad.jsx` | 581 | 424 | -27% |
| `EditarSeccionYPreguntas.jsx` | 788 | 619 | -21% |
| `Auditoria.jsx` | 721 | 639 | -11% |
| `Capacitaciones.jsx` | 825 | 336 | -59% ‚úÖ |
| `EditarFormulario.jsx` | 800 | 249 | -69% ‚úÖ |

### **Componentes Creados**
- **Dashboard:** 4 componentes + 2 hooks
- **Editor:** 12 componentes + 5 hooks ‚úÖ
- **Auditor√≠a:** 5 componentes
- **Capacitaciones:** 4 componentes + 3 hooks ‚úÖ

---

## ‚úÖ Checklist de Buenas Pr√°cticas

- ‚úÖ Componentes <400 l√≠neas
- ‚úÖ Hooks separados por responsabilidad
- ‚úÖ `React.memo` en componentes con props estables
- ‚úÖ `useCallback` en handlers
- ‚úÖ `useMemo` en c√°lculos pesados
- ‚úÖ Cleanup en efectos as√≠ncronos
- ‚úÖ Comparaciones personalizadas
- ‚úÖ Type safety (proptypes/documentaci√≥n)
- ‚úÖ DRY (Don't Repeat Yourself)
- ‚úÖ Single Responsibility Principle

---

**√öltima actualizaci√≥n:** ${new Date().toLocaleDateString()}

